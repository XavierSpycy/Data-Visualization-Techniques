<!DOCTYPE html>
<meta charset="utf-8">
<style>
    .legend text {
        font-family: Arial, sans-serif;
        font-size: 14px;
        fill: #333;
    }
</style>
<body>

<!-- load the d3.js library -->    	
<script src="//d3js.org/d3.v7.min.js"></script>
<script>
var margin = {top: 100, right: 0, bottom: 10, left: 0},
  width = 1500 - margin.left - margin.right,
  height = 960 - margin.top - margin.bottom;
var paths;

d3.csv("cars.csv")
    .then(function(data){
        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
        .append("g")
            .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");
        dimensions = Object.keys(data[0]).filter(function(d) { return d != "name" })
        // Extract manufacturers' names
        var mfrsArr = data.map(function(d) {
            return d.name.split(" ")[0].trim();
        });
        // Create an array containing unique values of manufacturer
        var uniqueNames = Array.from(new Set(mfrsArr));
        // Create a colorScale by concatenating several color scales 
        /// (should be longer than uniqueNames, or at least as long as uniqueNames)
        // The length of colorScale here is about 40 elements
        var colorScale = d3.scaleOrdinal(d3.schemeCategory10.concat(d3.schemeAccent.concat(d3.schemeDark2.concat(d3.schemePaired.concat(d3.schemeSet1)))));
        // Slice the colorScale to be the same length as the uniqueNames array, which can be used as the line colors
        var colors = colorScale.range().slice(0, uniqueNames.length);
        // Create name-color pairs in order to add the legend later
        var nameColors = uniqueNames.map(function(n, i) {
            return {name: n, color: colors[i]};
        });
        // Create a color scale corresponding to the names when plotting
        var color = d3.scaleOrdinal()
        .domain(uniqueNames)
        .range(colors);
        var y = {}
        for (i in dimensions) {
            name = dimensions[i]
            y[name] = d3.scaleLinear()
            .domain( d3.extent(data, function(d) { return +d[name]; }) )
            .range([height, 0])
        }
        x = d3.scalePoint()
            .range([0, width])
            .padding(1)
            .domain(dimensions);
        function path(d) {
            return d3.line()(dimensions.map(function(p) { return [x(p), y[p](d[p])]; }));
        }
        paths = svg
        .selectAll(".myPath")
        .data(data)
        .enter().append("path")
            .attr("d",  path)
            .attr("class", "myPath")
            .style("fill", "none")
            .style("stroke", function(d) { return color(d.name.split(" ")[0].trim()); })
            .style("opacity", 0.5)
        var axes = svg.selectAll(".myAxis")
        .data(dimensions)
        .enter().append("g")
            .attr("transform", function(d) { return "translate(" + x(d) + ")"; })
            .attr("class", "myAxis")
            .each(function(d) { d3.select(this).call(d3.axisLeft().scale(y[d])); });
        axes.append("text")
            .style("text-anchor", "middle")
            .attr("y", -9)
            .text(function(d) { return d; })
            .style("fill", "black")
            .style("font-size", "15px");
        // Add a legend
        var legend = svg.append("g")
            .attr("class", "legend")
            .attr("transform", "translate(20,50)");
        // Add a legent title
        legend.append("text")
            .attr("x", 0)
            .attr("y", -10)
            .text("Legend")
            .style("font-size", "16px")
            .style("font-weight", "bold");
        // Insert a border to the legend
        legend.insert("rect", ":first-child")
            .attr("class", "legend-border")
            .attr("width", 150)
            .attr("height", nameColors.length * 20 + 20)
            .attr("fill", "none")
            .attr("stroke", "gray")
            .attr("stroke-width", 2)
            .attr("transform", "translate(-10,-25)");
        var legendItems = legend.selectAll(".legend-item")
            .data(nameColors)
            .enter()
            .append("g")
            .attr("class", "legend-item")
            .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
        legendItems.append("circle")
            .attr("cx", 5)
            .attr("cy", 5)
            .attr("r", 5)
            .style("fill", function(d) { return d.color; })
            // Add a border to the colorful circles in the legend
            .style("stroke", "black")
            .style("stroke-width", "1px");
        legendItems.append("text")
            .attr("x", 15)
            .attr("y", 9)
            .text(function(d) { return d.name; })
            .attr("class", "legend-text");
        // Add a main title
        svg.append("text")
            .attr("x", (width / 2))
            .attr("y", 0 - (margin.top / 2))
            .attr("text-anchor", "middle")
            .style("font-size", "24px")
            .style("font-weight", "bold")
            .text("Cars Parallel Coordinate Plot");
        // Add a sub title
        svg.append("text")
            .attr("x", (width / 2))
            .attr("y", 0 - (margin.top / 2) + 25)
            .attr("text-anchor", "middle")
            .style("font-size", "18px")
            .style("fill", "gray")
            .text("Data source: cars.csv");


});

</script>
</body>