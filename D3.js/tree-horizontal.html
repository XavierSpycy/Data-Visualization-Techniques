<!DOCTYPE html>
<meta charset="utf-8">
<style> /* set the CSS */
/* Center the main title and the sub title */
h1 {
    text-align: center;
}
h2 {
    text-align:center;
    color:grey;
}
h3 {
    text-align: center;
    color: blueviolet
}
/* Center the margin*/
svg {
  display: block;
  margin: 0 auto;
}
div.container {
  text-align: center;
}

.node circle {
  fill: steelblue;
  stroke: black;
  stroke-width: 3px;
}

.node text { font: 12px sans-serif; }

.node--internal text {
  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 2px;
}

</style>

<body>
<h1>Major Cities in States of Australia</h1>
<h2>Horizontal Tree Graph</h2>
<h3>Data Source: 2021 Census of Population by the Australian Bureau of Statistics</h3>
<!-- load the d3.js library -->    	
<script src="//d3js.org/d3.v7.min.js"></script>
<script>

// set the dimensions and margins of the diagram
var margin = {top: 20, right: 150, bottom: 30, left: 90},
    width = 800 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;
var link, node;
// declares a tree layout and assigns the size
var treemap = d3.tree()
    .size([height, width]);
// loads tree data
d3.json("population-in-australia-short-label.json")
    .then(function(treeData){
    //  assigns the data to a hierarchy using parent-child relationships
    var nodes = d3.hierarchy(treeData, function(d) {
        return d.children;
    });
    // maps the node data to the tree layout
    nodes = treemap(nodes);
    // appends the svg object to the body of the page
    // appends a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom),
        g = svg.append("g")
        .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
    // adds the links between the nodes
    link = g.selectAll(".link")
        .data( nodes.descendants().slice(1))
        .enter().append("line")
        .attr("class", "link")
        .attr("x1", function(d) {return d.parent.y})
        .attr("y1", function(d) {return d.parent.x})
        .attr("x2", function(d) {return d.y})
        .attr("y2", function(d) {return d.x});
    // creates a colorScale
    var colorScale = d3.scaleSequential()
        .interpolator(d3.interpolateYlGnBu)
        .domain([0, d3.max(nodes.descendants(), function(d){ return d.data.size; })]);
    // defines a color scale based on the node size
    var colorScale = d3.scaleSequential(d3.interpolateBlues)
        .domain([d3.min(nodes.descendants(), d => d.data.size), 
           d3.max(nodes.descendants(), d => d.data.size)]);
    // 
    svg.append("text")
        .attr("x", 0)
        .attr("y", margin.top)
        .attr("font-size", "16px")
        .attr("font-weight", "bold")
        .text("Population");
    // adds a legend
    var legend = svg.append("g")
        .attr("class", "legend")
        .attr("transform", "translate(" + (0) + "," + (margin.top+10) + ")");
    // adds a rectangle for each color in the scale
    legend.selectAll("rect")
        .data(colorScale.ticks(6))
        .enter()
        .append("rect")
        .attr("x", 0)
        .attr("y", function(d, i) {
            return i * 20;
    })
        .attr("width", 15)
        .attr("height", 15)
        .style("fill", function(d) {
            return colorScale(d);
    });
    // adds a label for each color in the scale
    legend.selectAll("text")
        .data(colorScale.ticks(6))
        .enter()
        .append("text")
        .attr("x", 20)
        .attr("y", function(d, i) {
            return i * 20 + 12;
    })
        .text(function(d) {
            return d3.format(".2s")(d);
    });
    // adds each node as a group
    node = g.selectAll(".node")
        .data(nodes.descendants())
    .enter().append("g")
        .attr("class", function(d) { 
        return "node" + 
            (d.children ? " node--internal" : " node--leaf"); })
        .attr("transform", function(d) { 
        return "translate(" + d.y + "," + d.x + ")"; });
    // adds the circle to the node
    node.append("circle")
        .attr("r",10)
        .style("fill", function(d) {
        return colorScale(d.data.size);
    });
    // adds the text to the node
    node.append("text")
        .attr("dy", ".35em")
        .attr("x", function(d) { return d.children ? -13 : 13; })
        .style("text-anchor", function(d) { 
            return d.children ? "end" : "start"; })
        .text(function(d) { return d.data.name; });
    //
    d3.select(".node circle").
        filter(function(d) { return d.data.name === "Australia"; })
        .style("fill", "black");

});
    
</script>
</body>
