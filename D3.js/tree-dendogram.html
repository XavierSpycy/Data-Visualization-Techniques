<!DOCTYPE html>
<meta charset="utf-8">
<body>
  <h1>Major Cities in States of Australia</h1>
  <h2>Dendogram Tree Graph</h2>
  <h3>Data Source: 2021 Census of Population by the Australian Bureau of Statistics</h3>
</body>
<style> /* set the CSS */
h1 {
    text-align: center;
}
h2 {
    text-align:center;
    color:grey;
}
h3 {
    text-align: center;
    color: blueviolet
}
.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 3px;
}

.node text { font: 12px sans-serif; }

.node--internal text {
  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 2px;
}

</style>

<body>

<!-- load the d3.js library -->    	
<script src="//d3js.org/d3.v6.min.js"></script>
<script>

// set the dimensions and margins of the diagram
var margin = {top: 10, right: 150, bottom: 30, left: 90},
    width = 1600 + margin.left + margin.right,
    height = 1200 + margin.top + margin.bottom;

var link, node;

// declares a tree layout and assigns the size
var treemap = d3.cluster()
    .size([1200, 900]);

// loads tree data
d3.json("population-in-australia-short-label.json")
    .then(function(treeData){
    //  assigns the data to a hierarchy using parent-child relationships
    var nodes = d3.hierarchy(treeData, function(d) {
        return d.children;
    });

    // maps the node data to the tree layout
    nodes = treemap(nodes);

    // append the svg object to the body of the page
    // appends a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom),
        g = svg.append("g")
        .attr("transform",
                "translate(" + (margin.left + 800)  + "," + margin.top + ")");

    // adds the links between the nodes
    link = g.selectAll(".link")
        .data(nodes.descendants().slice(1))
    .enter().append("line")
        .attr("class", "link")
        .attr("x1", function(d) {return d.parent.y})
        .attr("y1", function(d) {return d.parent.x})
        .attr("x2", function(d) {return d.y})
        .attr("y2", function(d) {return d.x});


    // adds each node as a group
    node = g.selectAll(".node")
        .data(nodes.descendants())
    .enter().append("g")
      .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });
      
    // adds the circle to the node
    node.append("circle")
      .attr("r", d => Math.sqrt(d.data.size)/250)
      .style("fill", "blue")
      .style("opacity", "0.7");
    // adds the text to the node
    node.append("text")
      .attr("dy", "0.31em")
      .attr("x", function(d) { return d.children ? -8 : 8; })
      .style("text-anchor", function(d) { return d.children ? "end" : "start"; })
      .text(d => d.data.name);
    //
    var legendData = [
    { size: Math.sqrt(1000000)/250, label: '1.0M' },
    { size: Math.sqrt(2000000)/250, label: '2.0M' },
    { size: Math.sqrt(3000000)/250, label: '3.0M' },
    { size: Math.sqrt(4000000)/250, label: '4.0M' },
    { size: Math.sqrt(5000000)/250, label: '5.0M' },
    { size: Math.sqrt(6000000)/250, label: '6.0M' },
    { size: Math.sqrt(7000000)/250, label: '7.0M' },
    { size: Math.sqrt(8000000)/250, label: '8.0M' },
    ];
  function createLegend(data) {
  // select the div where you want to add the legend
  var legendDiv = d3.select("body").append("div")
    .attr("class", "legend")
    .style("position", "absolute")
    .style("left", "900px")
    .style("top", "300px");
  // add circles and labels to the legend
  var legend = legendDiv.selectAll(".legend-item")
    .data(data)
    .enter().append("div")
      .attr("class", "legend-item");

  legend.append("div")
    .attr("class", "legend-circle")
    .style("background-color",  "blue")
    .style("opacity", "0.7")
    .style("width", function(d) { return d.size*2 + "px"; })
    .style("height", function(d) { return d.size*2 + "px"; })
    .style("border-radius", function(d) { return d.size + "px"; });
  legend.append("div")
    .attr("class", "legend-label")
    .text(function(d) { return d.label; });
}
// create the legend
  createLegend(legendData);

});
    
</script>
</body>
