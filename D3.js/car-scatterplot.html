<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz3"></div>
<script>

// set the dimensions and margins of the graph
var margin = {top: 100, right: 30, bottom: 40, left: 50},
    width = 1000 - margin.left - margin.right,
    height = 800 - margin.top - margin.bottom;

// append the SVG object to the body of the page
var svg = d3.select("#my_dataviz3")
  .append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")")

// Add the black box around the chart
svg.append("rect")
    .attr("x",0)
    .attr("y",0)
    .attr("height", height)
    .attr("width", width-150)
    .style("fill", "none")
    .style("stroke", "black")

//Read the data
d3.csv("cars.csv").then(function(data) {
// Set colors and groups
  var mfrsArr = data.map(function(d) { 
  return d.name.split(" ")[0].trim();
});
var uniqueNames = Array.from(new Set(mfrsArr));
var colorScale = d3.scaleOrdinal(d3.schemeCategory10.concat(d3.schemeAccent.concat(d3.schemeDark2.concat(d3.schemePaired.concat(d3.schemeSet1)))));
var colors = colorScale.range().slice(0, uniqueNames.length);
var nameColors = uniqueNames.map(function(n, i) { 
  return {name: n, color: colors[i]};
});
var color = d3.scaleOrdinal()
  .domain(uniqueNames)
  .range(colors);
// Add X axis
var x = d3.scaleLinear()
    .domain(d3.extent(data, function(d) { return +d["displacement (cc)"]; }))
    .range([ 0, width - 200])
svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x))

// Add Y axis
var y = d3.scaleLinear()
  .domain(d3.extent(data, function(d) { return +d["economy (mpg)"]; }))
  .range([ height, 0])
  .nice()
svg.append("g")
  .call(d3.axisLeft(y))

// Add X axis label:
svg.append("text")
    .attr("text-anchor", "end")
    .attr("x",120)
    .attr("y", height + 30)
    .text("Diplacement(cc)");

// Y axis label:
svg.append("text")
    .attr("text-anchor", "end")
    .attr("transform", "rotate(-90)")
    .attr("y", -margin.left+20)
    .attr("x", -margin.top+105)
    .text("Economy(mpg)")

// Add dots
svg.append('g')
  .selectAll("dot")
  .data(data)
  .enter()
  .append("path")
    .attr("d", d3.symbol()
      .size(120)
    )
    .attr("transform", function(d) { return "translate(" + x(+d["displacement (cc)"]) + "," + y(+d["economy (mpg)"]) + ")"; })
    .style("fill", function(d) { return color(d.name.split(" ")[0].trim()); })
    .style("opacity", 0.8)
// Add a legend
var legend = svg.append("g")
    .attr("class", "legend")
    .attr("transform", "translate(800,0)");
// Add a legent title
legend.append("text")
      .attr("x", 0)
      .attr("y", -10)
      .text("Legend")
      .style("font-size", "16px")
      .style("font-weight", "bold");
// Add a legend border
legend.append("rect")
      .attr("x", -10)
      .attr("y", -25)
      .attr("width", 150)
      .attr("height", uniqueNames.length * 20 + 20)
      .style("stroke", "black")
      .style("stroke-width", "1px")
      .style("fill", "none");
var legendItems = legend.selectAll(".legend-item")
    .data(nameColors)
    .enter()
    .append("g")
    .attr("class", "legend-item")
    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
legendItems.append("circle")
    .attr("cx", 5)
    .attr("cy", 5)
    .attr("r", 5)
    .style("fill", function(d) { return d.color; })
    .style("stroke", "black")
    .style("stroke-width", "1px");
legendItems.append("text")
    .attr("x", 15)
    .attr("y", 9)
    .text(function(d) { return d.name; });
// Add a main title
svg.append("text")
    .attr("x", (width / 2))
    .attr("y", 0 - (margin.top / 2))
    .attr("text-anchor", "middle")
    .style("font-size", "24px")
    .style("font-weight", "bold")
    .text("Cars Scatterplot");
// Add a sub title
svg.append("text")
    .attr("x", (width / 2))
    .attr("y", 0 - (margin.top / 2) + 25)
    .attr("text-anchor", "middle")
    .style("font-size", "18px")
    .style("fill", "grey")
    .text("Data source: cars.csv");
})
</script>